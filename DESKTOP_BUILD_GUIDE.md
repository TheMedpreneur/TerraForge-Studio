# 🖥️ TerraForge Studio - Desktop Application Build Guide

Complete guide to building and distributing TerraForge Studio as a professional desktop application.

## 📋 Table of Contents

- [Overview](#overview)
- [Prerequisites](#prerequisites)
- [Quick Start](#quick-start)
- [Detailed Build Process](#detailed-build-process)
- [Distribution](#distribution)
- [GitHub Release](#github-release)
- [Troubleshooting](#troubleshooting)

## 🎯 Overview

TerraForge Studio can be packaged as a standalone desktop application for Windows, combining:
- **FastAPI backend** - Terrain generation engine
- **React frontend** - Professional UI
- **pywebview** - Native window wrapper
- **PyInstaller** - Single executable packaging

The result is a professional desktop app similar to Gyroflow, Blender, or Unity.

## ✅ Prerequisites

### Required Software

1. **Python 3.13+**
   ```bash
   python --version
   # Should output: Python 3.13.x
   ```

2. **Node.js 20+**
   ```bash
   node --version
   # Should output: v20.x.x
   ```

3. **Git** (for version control)
   ```bash
   git --version
   ```

### Install Build Dependencies

```bash
# Python dependencies
pip install -r requirements.txt
pip install -r desktop/desktop_requirements.txt

# Frontend dependencies
cd frontend-new
npm install
cd ..
```

## 🚀 Quick Start

### Option 1: PowerShell (Recommended)

```powershell
.\desktop\build.ps1
```

### Option 2: Batch Script

```cmd
desktop\build.bat
```

### Option 3: Python Script

```bash
python desktop/build.py
```

## 🔨 Detailed Build Process

### Step 1: Build Frontend

```bash
cd frontend-new
npm run build
cd ..
```

This creates `frontend-new/dist/` with optimized React build.

### Step 2: Generate Icons

Icons are automatically generated by `build.py`, but you can customize:

```python
# Edit desktop/build.py - generate_icons() function
# Or provide custom icons:
# - desktop/icon.png (512x512)
# - desktop/icon.ico (Windows icon)
```

### Step 3: Build Executable

```bash
cd desktop
pyinstaller terraforge.spec --clean --noconfirm
```

This creates:
- `desktop/build/` - Temporary build files
- `desktop/dist/TerraForge Studio/` - Final application

### Step 4: Test the Executable

```bash
cd desktop/dist/TerraForge Studio
./TerraForge Studio.exe
```

## 📦 Distribution

### Option A: Portable ZIP

Create a portable version (no installation required):

```powershell
# Windows PowerShell
Compress-Archive -Path "desktop/dist/TerraForge Studio" -DestinationPath "TerraForge-Studio-v1.0.0-Windows-x64.zip"
```

**Contents:**
```
TerraForge-Studio-v1.0.0-Windows-x64.zip
├── TerraForge Studio.exe
├── README.txt
├── LICENSE.txt
├── .env.example
└── _internal/ (dependencies)
```

### Option B: Windows Installer

Using Inno Setup:

1. Install [Inno Setup](https://jrsoftware.org/isinfo.php)
2. Open `desktop/installer.iss`
3. Click Build → Compile
4. Output: `desktop/installer_output/TerraForge-Studio-Setup-v1.0.0.exe`

**Advantages:**
- Professional installation experience
- Start menu integration
- Desktop shortcut option
- Automatic uninstaller
- Smaller download (compressed)

### Option C: Microsoft Store (Future)

For distribution via Microsoft Store, use:
- MSIX packaging
- Windows App SDK
- Store submission process

## 🌐 GitHub Release

### Automatic Release (GitHub Actions)

1. **Tag a version:**
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

2. **Workflow runs automatically:**
   - Builds frontend
   - Creates executable
   - Generates SHA256 checksums
   - Creates GitHub Release
   - Uploads artifacts

3. **Result:**
   - `TerraForge-Studio-v1.0.0-Windows-x64.zip`
   - `TerraForge-Studio-v1.0.0-Windows-x64.zip.sha256`

### Manual Release

1. **Build locally:**
   ```powershell
   .\desktop\build.ps1
   ```

2. **Create ZIP:**
   ```powershell
   Compress-Archive -Path "desktop/dist/TerraForge Studio" -DestinationPath "TerraForge-Studio-v1.0.0-Windows-x64.zip"
   ```

3. **Calculate checksum:**
   ```powershell
   Get-FileHash TerraForge-Studio-v1.0.0-Windows-x64.zip -Algorithm SHA256 | Select-Object Hash | Out-File TerraForge-Studio-v1.0.0-Windows-x64.zip.sha256
   ```

4. **Create GitHub Release:**
   - Go to GitHub → Releases → New Release
   - Create tag: `v1.0.0`
   - Upload ZIP and SHA256 files
   - Write release notes

## 🐛 Troubleshooting

### Build Issues

**Problem: "PyInstaller not found"**
```bash
pip install pyinstaller>=6.3.0
```

**Problem: "Frontend build failed"**
```bash
cd frontend-new
rm -rf node_modules package-lock.json
npm install
npm run build
```

**Problem: "Module not found" during build**
```bash
# Add to terraforge.spec hiddenimports
hiddenimports += ['missing_module_name']
```

### Runtime Issues

**Problem: Executable won't start**
- Run from command line to see errors:
  ```cmd
  "desktop\dist\TerraForge Studio\TerraForge Studio.exe"
  ```
- Check Windows Event Viewer for crash logs

**Problem: "DLL load failed"**
- Missing Visual C++ Redistributable
- Install: https://aka.ms/vs/17/release/vc_redist.x64.exe

**Problem: Antivirus blocking executable**
- Code sign the executable (requires certificate)
- Add exclusion in antivirus settings
- Build with `--debug` flag to diagnose

### Size Issues

**Problem: Executable too large (>500MB)**

Reduce size:
```python
# In terraforge.spec, add excludes:
excludes=[
    'matplotlib',
    'pytest',
    'jupyter',
    'IPython',
    'tkinter',
    'test',
    'unittest',
]
```

## 📊 Build Artifacts

| File | Size | Description |
|------|------|-------------|
| `TerraForge Studio.exe` | ~20MB | Main executable |
| `_internal/` | ~200MB | Python runtime + dependencies |
| `frontend-new/dist/` | ~10MB | React frontend |
| **Total** | ~230MB | Complete portable app |

## 🔒 Code Signing

For production releases, sign the executable to avoid Windows SmartScreen warnings:

```powershell
# Requires code signing certificate
signtool sign /f "certificate.pfx" /p "password" /tr http://timestamp.digicert.com /td sha256 /fd sha256 "TerraForge Studio.exe"
```

**Benefits:**
- No SmartScreen warnings
- Shows publisher name
- Builds user trust

## 🌍 Multi-Platform

### Linux (Future)

```bash
# Use PyInstaller on Linux
pyinstaller --onefile --windowed launcher.py
```

### macOS (Future)

```bash
# Use PyInstaller + py2app
python setup.py py2app
```

## 📈 Continuous Deployment

The GitHub Actions workflow (`.github/workflows/build-release.yml`) automatically:
1. Builds on every version tag push
2. Runs tests
3. Creates release artifacts
4. Publishes to GitHub Releases

**To trigger:**
```bash
git tag v1.0.1
git push origin v1.0.1
```

## 📞 Support

- **Build Issues:** Open an issue with build logs
- **Runtime Issues:** Include error messages and system info
- **Feature Requests:** Use GitHub Discussions

---

**Happy Building! 🚀**
